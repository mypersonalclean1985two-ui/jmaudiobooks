<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>JM Audiobooks - Audio Player</title>
    <link rel="stylesheet" href="css/style.css?v=8.0">
    <link rel="stylesheet" href="css/auth.css?v=1.0">
    <link rel="stylesheet" href="css/support.css?v=1.0">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JM Audiobooks">

    <!-- Firebase SDKs (Local Bundled Version for Reliability) -->
    <script src="lib/firebase-app-compat.js"></script>
    <script src="lib/firebase-auth-compat.js"></script>
    <script src="lib/firebase-firestore-compat.js"></script>
    <script src="lib/firebase-storage-compat.js"></script>

    <!-- App Config & Initializers -->
    <script src="js/firebase-config.js?v=11.0"></script>
    <script src="js/category-utils.js?v=11.0"></script>
    <script src="js/category-enhance.js?v=11.0"></script>
</head>

<body>
    <div class="app-container">
        <!-- Modern Splash Screen -->
        <div id="splash-screen"
            style="position:fixed;top:0;left:0;width:100%;height:100%;background:#090b0e;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);overflow:hidden;">

            <!-- Animated Background Marquee -->
            <div class="splash-marquee-container" id="splash-marquee">
                <!-- Titles will be injected by JS -->
            </div>

            <div class="splash-glass-card">
                <div style="font-size:4.5rem;margin-bottom:20px;filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.5));">
                    üìö</div>
                <h1
                    style="font-size:2.4rem;font-weight:900;letter-spacing:-1px;background:linear-gradient(135deg,#f59e0b 0%,#ef4444 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;">
                    JM Audiobooks</h1>
                <p style="color:rgba(255,255,255,0.5);font-size:1rem;margin-bottom:32px;font-weight:500;">Your Story,
                    Anywhere</p>

                <div class="progress-container-splash">
                    <div class="progress-bar-splash" id="splash-progress"></div>
                </div>

                <div style="display:flex;align-items:center;gap:10px;margin-top:16px;">
                    <div class="loader"
                        style="width:16px;height:16px;border:2px solid rgba(255,255,255,0.1);border-top-color:var(--accent-primary);border-radius:50%;animation:spin 1s linear infinite;">
                    </div>
                    <p id="splash-status"
                        style="color:rgba(255,255,255,0.7);font-size:0.85rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;">
                        Initializing...</p>
                    <span id="splash-percent"
                        style="color:var(--accent-primary);font-size:0.85rem;font-weight:700;">0%</span>
                </div>
            </div>
        </div>

        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-header">
                <div class="app-icon">üìö</div>
                <span class="greeting" id="greeting">Good evening</span>
                <div class="profile-pic" onclick="navigateTo('profile')">üë§</div>
            </div>
            <h1 class="app-title">JM Audiobooks</h1>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Content will be dynamically loaded here -->
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-btn active" data-target="home">
                <span class="nav-icon">üè†</span>
                <span>Home</span>
            </a>
            <a href="#" class="nav-btn" data-target="discover">
                <span class="nav-icon">üîç</span>
                <span>Discover</span>
            </a>
            <a href="#" class="nav-btn" data-target="library">
                <span class="nav-icon">üìö</span>
                <span>Library</span>
            </a>
            <a href="#" class="nav-btn" data-target="profile">
                <span class="nav-icon">üë§</span>
                <span>Profile</span>
            </a>
        </div>

        <!-- Book Modal -->
        <div class="modal" id="book-modal">
            <div class="modal-content">
                <span class="close-btn">√ó</span>
                <div class="modal-left">
                    <img src="" alt="Book Cover" class="modal-cover" id="modal-cover-img">
                </div>
                <div class="modal-right">
                    <h2 class="modal-title" id="modal-title">Book Title</h2>
                    <p class="modal-author" id="modal-author">Author Name</p>
                    <p class="price-tag" id="modal-price">$0.00</p>
                    <div class="modal-actions">
                        <button class="btn-primary" id="modal-read-btn">Listen Now</button>
                        <button class="btn-secondary" id="modal-library-btn">Add to Library</button>
                    </div>
                    <div class="modal-desc">
                        <h3 style="color: var(--text-primary);">About</h3>
                        <div id="modal-description" style="color: var(--text-secondary); line-height: 1.6;">
                            <!-- Description will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div class="modal" id="profile-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-profile-modal">√ó</span>
                <div class="modal-right">
                    <h2 class="modal-title">Edit Profile</h2>
                    <div style="display: flex; flex-direction: column; gap: 16px; width: 100%; margin-top: 20px;">
                        <div style="text-align: center; margin-bottom: 8px;">
                            <div style="position: relative; width: 100px; height: 100px; margin: 0 auto;">
                                <img id="edit-profile-preview" src=""
                                    style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: none;">
                                <div id="edit-profile-placeholder"
                                    style="width: 100%; height: 100%; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white;">
                                    üë§</div>
                                <label for="profile-upload"
                                    style="position: absolute; bottom: 0; right: 0; background: var(--accent-primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                    üì∑
                                </label>
                                <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <div>
                            <label
                                style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px; display: block;">Name</label>
                            <input type="text" id="profile-name-input" class="search-input" style="padding-left: 16px;"
                                placeholder="Enter your name">
                        </div>
                        <div>
                            <label
                                style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px; display: block;">Bio</label>
                            <textarea id="profile-bio-input" class="search-input"
                                style="padding: 12px 16px; height: 80px; resize: none; font-family: inherit;"
                                placeholder="Tell us about yourself..."></textarea>
                        </div>
                        <div>
                            <label
                                style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px; display: block;">Email</label>
                            <input type="email" id="profile-email-input" class="search-input"
                                style="padding-left: 16px;" placeholder="Enter your email">
                        </div>
                        <button class="btn-primary" id="save-profile-btn" style="margin-top: 8px;">Save
                            Changes</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content" style="height: 80%; border-radius: 24px 24px 0 0; padding: 24px;">
                <span class="close-btn" id="close-settings-modal">√ó</span>
                <h2 class="modal-title" style="margin-bottom: 24px;">Settings</h2>
                <div class="settings-list">
                    <div class="settings-item">
                        <div class="settings-icon">üåô</div>
                        <div class="settings-info">
                            <div class="settings-label">Dark Mode</div>
                            <div class="settings-sub">Adjust app appearance</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div class="settings-icon">üîî</div>
                        <div class="settings-info">
                            <div class="settings-label">Notifications</div>
                            <div class="settings-sub">Manage alerts</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="notifications-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="settings-item" onclick="window.showModal('about-modal')">
                        <div class="settings-icon">‚ÑπÔ∏è</div>
                        <div class="settings-info">
                            <div class="settings-label">About App</div>
                            <div class="settings-sub">Version 3.0</div>
                        </div>
                        <div style="color: var(--text-secondary);">‚Ä∫</div>
                    </div>
                    <div class="settings-item" onclick="window.showModal('privacy-modal')">
                        <div class="settings-icon">üîí</div>
                        <div class="settings-info">
                            <div class="settings-label">Privacy Policy</div>
                            <div class="settings-sub">Read our terms</div>
                        </div>
                        <div style="color: var(--text-secondary);">‚Ä∫</div>
                    </div>

                    <!-- Account Deletion Section -->
                    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
                        <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 12px;">DANGER ZONE
                        </p>
                        <button class="btn-secondary" id="confirm-delete-account-btn"
                            style="width: 100%; color: #ef4444; border-color: rgba(239, 68, 68, 0.2); background: rgba(239, 68, 68, 0.05);">
                            Delete Account Permanently
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logout Confirmation Modal -->
        <div class="modal" id="logout-modal">
            <div class="modal-content"
                style="height: auto; min-height: 200px; border-radius: 24px; text-align: center; padding: 24px;">
                <h2 class="modal-title" style="margin-bottom: 16px;">Log Out</h2>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Are you sure you want to log out? Your
                    profile will be reset to Guest.</p>
                <div style="display: flex; gap: 12px; width: 100%;">
                    <button class="btn-secondary" id="cancel-logout-btn" style="flex: 1;">Cancel</button>
                    <button class="btn-primary" id="confirm-logout-btn"
                        style="flex: 1; background-color: #ef4444; color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">Log
                        Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div class="modal" id="support-modal">
        <div class="modal-content"
            style="height: 85%; border-radius: 24px 24px 0 0; padding: 0; display: flex; flex-direction: column;">
            <div style="padding: 24px 24px 0 24px;">
                <span class="close-btn" onclick="window.closeModal('support-modal')">√ó</span>
                <h2 class="modal-title" style="margin-bottom: 24px;">Contact Support</h2>

                <!-- Support Tabs -->
                <div class="support-tabs"
                    style="display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color);">
                    <div class="support-tab active" id="tab-new-ticket" onclick="window.switchSupportTab('new')">New
                        Ticket</div>
                    <div class="support-tab" id="tab-history" onclick="window.switchSupportTab('history')">My Tickets
                    </div>
                </div>
            </div>

            <!-- New Ticket View -->
            <div id="view-new-ticket" style="padding: 0 24px 24px 24px; overflow-y: auto; flex: 1;">
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display:block; margin-bottom: 8px; color: var(--text-secondary);">Category</label>
                    <select id="ticket-category" class="auth-input"
                        style="width: 100%; appearance: none; background-color: var(--input-bg);">
                        <option value="General">General Inquiry</option>
                        <option value="Bug">Report a Bug</option>
                        <option value="Content">Content Issue (Book/Audio)</option>
                        <option value="Billing">Billing & Subscription</option>
                        <option value="Feature">Feature Request</option>
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display:block; margin-bottom: 8px; color: var(--text-secondary);">Subject</label>
                    <input type="text" id="ticket-subject" class="auth-input" placeholder="Brief summary of issue"
                        style="width: 100%;">
                </div>

                <div class="form-group" style="margin-bottom: 24px;">
                    <label style="display:block; margin-bottom: 8px; color: var(--text-secondary);">Message</label>
                    <textarea id="ticket-message" class="auth-input" rows="6"
                        placeholder="Please describe your issue in detail...&#10;- Device Model&#10;- Steps to reproduce&#10;- Error messages"
                        style="width: 100%; resize: none;"></textarea>
                </div>

                <button class="btn-primary" id="submit-ticket-btn" onclick="window.submitTicket()"
                    style="width: 100%;">Submit Ticket</button>
            </div>

            <!-- History View -->
            <div id="view-ticket-history" style="padding: 0 24px 24px 24px; overflow-y: auto; flex: 1; display: none;">
                <div id="ticket-list-container">
                    <!-- Tickets injected here -->
                    <div style="text-align: center; color: var(--text-secondary); margin-top: 40px;">Loading tickets...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div class="modal" id="subscription-modal">
        <div class="modal-content"
            style="height: auto; border-radius: 24px; padding: 32px 24px; text-align: center; max-width: 400px; width: 90%;">
            <span class="close-btn" id="close-subscription-modal">√ó</span>
            <div style="margin-bottom: 24px;">
                <div style="font-size: 3rem; margin-bottom: 16px;">üéß</div>
                <h2 class="modal-title" style="margin-bottom: 8px;">Unlock Everything</h2>
                <p style="color: var(--text-secondary); line-height: 1.5;">Get unlimited access to thousands of premium
                    audiobooks.</p>
            </div>

            <!-- Annual Plan (Best Value) -->
            <div class="subscription-plan-card" data-plan="annual" id="plan-annual"
                style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; margin-bottom: 16px; border: 2px solid var(--accent-primary); position: relative; overflow: hidden; cursor: pointer; transition: all 0.3s ease;">
                <div
                    style="position: absolute; top: 0; right: 0; background: var(--accent-primary); color: white; font-size: 0.7rem; padding: 4px 12px; border-radius: 0 0 0 12px; font-weight: bold;">
                    BEST VALUE</div>
                <div class="plan-checkmark"
                    style="position: absolute; top: 12px; left: 12px; width: 24px; height: 24px; border-radius: 50%; background: var(--accent-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                    ‚úì</div>
                <h3 style="font-size: 1.2rem; margin-bottom: 8px;">Premium Annual</h3>
                <div style="font-size: 2.5rem; font-weight: 800; color: var(--text-primary); margin-bottom: 4px;">
                    $25.99<span style="font-size: 1rem; color: var(--text-secondary); font-weight: normal;">/year</span>
                </div>
                <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 12px;">Save 40% ‚Ä¢ Just
                    $2.08/month</div>
                <div
                    style="color: var(--accent-primary); font-weight: 600; margin-bottom: 16px; font-size: 0.9rem; padding: 4px 8px; background: rgba(99, 102, 241, 0.1); display: inline-block; border-radius: 6px;">
                    14-Day Free Trial</div>
                <ul
                    style="text-align: left; list-style: none; padding: 0; margin: 0; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8;">
                    <li>‚úÖ Unlimited Listening</li>
                    <li>‚úÖ High Quality Audio</li>
                    <li>‚úÖ Offline Support</li>
                    <li>‚úÖ Cancel Anytime</li>
                </ul>
            </div>

            <!-- Monthly Plan -->
            <div class="subscription-plan-card" data-plan="monthly" id="plan-monthly"
                style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; margin-bottom: 24px; border: 1px solid var(--border-color); position: relative; cursor: pointer; transition: all 0.3s ease;">
                <div class="plan-checkmark"
                    style="position: absolute; top: 12px; left: 12px; width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--border-color); display: none; align-items: center; justify-content: center; color: white; font-weight: bold;">
                </div>
                <h3 style="font-size: 1.2rem; margin-bottom: 8px;">Premium Monthly</h3>
                <div style="font-size: 2.5rem; font-weight: 800; color: var(--text-primary); margin-bottom: 4px;">
                    $3.99<span style="font-size: 1rem; color: var(--text-secondary); font-weight: normal;">/mo</span>
                </div>
                <div
                    style="color: var(--accent-primary); font-weight: 600; margin-bottom: 16px; font-size: 0.9rem; padding: 4px 8px; background: rgba(99, 102, 241, 0.1); display: inline-block; border-radius: 6px;">
                    14-Day Free Trial</div>
                <ul
                    style="text-align: left; list-style: none; padding: 0; margin: 0; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.8;">
                    <li>‚úÖ Unlimited Listening</li>
                    <li>‚úÖ High Quality Audio</li>
                    <li>‚úÖ Offline Support</li>
                    <li>‚úÖ Cancel Anytime</li>
                </ul>
            </div>

            <button class="btn-primary" id="subscribe-btn"
                style="width: 100%; padding: 16px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); margin-bottom: 12px;">Start
                Free Trial</button>
            <button class="btn-secondary" id="restore-btn"
                style="width: 100%; color: var(--text-secondary); font-size: 0.9rem;">Restore Purchases</button>

            <!-- Apple-Required Legal Text -->
            <div
                style="margin-top: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; border: 1px solid var(--border-color);">
                <p
                    style="font-size: 0.7rem; color: var(--text-secondary); line-height: 1.6; text-align: left; margin: 0;">
                    Payment will be charged to your Apple ID account at confirmation of purchase.
                    Subscription automatically renews unless canceled at least 24 hours before the end of the current
                    period.
                    Manage or cancel your subscription in Account Settings.
                </p>
            </div>

            <!-- Legal Links -->
            <div style="margin-top: 16px; display: flex; justify-content: center; gap: 16px;">
                <a href="privacy.html" target="_blank"
                    style="font-size: 0.75rem; color: var(--accent-primary); text-decoration: none; font-weight: 600;">Privacy
                    Policy</a>
                <span style="color: var(--text-secondary); font-size: 0.75rem;">|</span>
                <a href="terms.html" target="_blank"
                    style="font-size: 0.75rem; color: var(--accent-primary); text-decoration: none; font-weight: 600;">Terms
                    of Use</a>
            </div>

            <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 12px;">
                Plan auto-renews after trial. Cancel anytime.
            </p>
        </div>
    </div>

    <script>
        // Subscription Plan Selection
        let selectedPlan = 'annual'; // Default to annual (best value)

        function selectPlan(planType) {
            selectedPlan = planType;
            const annualCard = document.getElementById('plan-annual');
            const monthlyCard = document.getElementById('plan-monthly');
            const annualCheck = annualCard.querySelector('.plan-checkmark');
            const monthlyCheck = monthlyCard.querySelector('.plan-checkmark');

            // Reset both cards
            annualCard.style.border = '2px solid var(--accent-primary)';
            monthlyCard.style.border = '1px solid var(--border-color)';
            annualCheck.style.display = 'none';
            monthlyCheck.style.display = 'none';

            // Highlight selected card
            if (planType === 'annual') {
                annualCard.style.border = '2px solid var(--accent-primary)';
                annualCard.style.boxShadow = '0 8px 24px rgba(99, 102, 241, 0.3)';
                annualCheck.style.display = 'flex';
                monthlyCard.style.boxShadow = 'none';
            } else {
                monthlyCard.style.border = '2px solid var(--accent-primary)';
                monthlyCard.style.boxShadow = '0 8px 24px rgba(99, 102, 241, 0.3)';
                monthlyCheck.style.display = 'flex';
                monthlyCheck.style.background = 'var(--accent-primary)';
                monthlyCheck.innerHTML = '‚úì';
                annualCard.style.boxShadow = 'none';
            }

            console.log('Selected plan:', planType);
        }

        // Add click handlers when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            const annualCard = document.getElementById('plan-annual');
            const monthlyCard = document.getElementById('plan-monthly');

            if (annualCard) {
                annualCard.addEventListener('click', () => selectPlan('annual'));
            }
            if (monthlyCard) {
                monthlyCard.addEventListener('click', () => selectPlan('monthly'));
            }

            // Initialize with annual selected
            selectPlan('annual');

            // Subscribe button handler
            const subscribeBtn = document.getElementById('subscribe-btn');
            if (subscribeBtn) {
                subscribeBtn.addEventListener('click', function () {
                    console.log('Starting subscription for plan:', selectedPlan);

                    // Check if running in Capacitor (iOS/Android)
                    if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.Purchases) {
                        // iOS/Android In-App Purchase
                        const productId = selectedPlan === 'annual' ? 'premium_annual' : 'premium_monthly';
                        console.log('Initiating iOS/Android purchase for:', productId);

                        window.Capacitor.Plugins.Purchases.purchaseProduct({ productIdentifier: productId })
                            .then(result => {
                                console.log('Purchase successful:', result);
                                alert('Subscription activated! Enjoy unlimited audiobooks.');
                                document.getElementById('subscription-modal').style.display = 'none';
                            })
                            .catch(error => {
                                console.error('Purchase failed:', error);
                                if (error.code !== 'USER_CANCELLED') {
                                    alert('Purchase failed. Please try again.');
                                }
                            });
                    } else {
                        // Web fallback - show message
                        console.log('Web environment - showing subscription info');
                        alert(`Starting ${selectedPlan} subscription trial!\n\nPrice: ${selectedPlan === 'annual' ? '$25.99/year' : '$3.99/month'}\n14-day free trial included.`);
                        document.getElementById('subscription-modal').style.display = 'none';
                    }
                });
            }

            // Restore purchases button
            const restoreBtn = document.getElementById('restore-btn');
            if (restoreBtn) {
                restoreBtn.addEventListener('click', function () {
                    if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.Purchases) {
                        console.log('Restoring purchases...');
                        window.Capacitor.Plugins.Purchases.restorePurchases()
                            .then(result => {
                                console.log('Restore successful:', result);
                                alert('Purchases restored successfully!');
                            })
                            .catch(error => {
                                console.error('Restore failed:', error);
                                alert('No purchases found to restore.');
                            });
                    } else {
                        alert('Restore purchases is only available in the mobile app.');
                    }
                });
            }
        });
    </script>
    <!-- About App Modal -->
    <div class="modal" id="about-modal">
        <div class="modal-content" style="height: auto; border-radius: 24px; padding: 24px; text-align: center;">
            <span class="close-btn" id="close-about-modal">√ó</span>
            <h2 class="modal-title" style="margin-bottom: 16px;">About JM Audiobooks</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6;">
                Version 3.0<br>
                Built with ‚ù§Ô∏è for book lovers.<br><br>
                Enjoy a vast collection of audiobooks completely free.
            </p>
            <button class="btn-primary" onclick="window.closeModal('about-modal')">Close</button>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal" id="privacy-modal">
        <div class="modal-content" style="height: 85%; border-radius: 24px 24px 0 0; padding: 24px;">
            <span class="close-btn" id="close-privacy-modal">√ó</span>
            <h2 class="modal-title" style="margin-bottom: 16px;">Privacy Policy</h2>
            <div style="overflow-y: auto; text-align: left; color: var(--text-secondary); line-height: 1.6;">
                <p><strong>Effective Date:</strong> Dec 18, 2025</p>
                <br>
                <p>Your privacy is important to us. This policy explains how we handle your data.</p>
                <br>
                <h3>1. Data Collection</h3>
                <p>We collect basic profile information (name, email) and reading progress to sync your experience
                    across devices.</p>
                <br>
                <h3>2. Data Storage</h3>
                <p>Your data is stored securely in the cloud (Firebase) and is not shared with third parties.</p>
                <br>
                <h3>3. Contact</h3>
                <p>If you have questions, please contact support.</p>
            </div>
            <button class="btn-primary" style="margin-top: 20px;"
                onclick="window.closeModal('privacy-modal')">Close</button>
        </div>
    </div>
    </div>

    <!-- Main Application Logic -->
    <script src="js/app.js?v=21.0"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>

</html>